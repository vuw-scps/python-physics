


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>Basic fitting - python-physics</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fe0cca5b.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a46bcfb3.min.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nonlinear-fitting-example" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="python-physics" class="md-header-nav__button md-logo" aria-label="python-physics">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            python-physics
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Basic fitting
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="python-physics" class="md-nav__button md-logo" aria-label="python-physics">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    python-physics
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Phys114
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Phys114" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Phys114
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys114/HailStone/" title="HailStone" class="md-nav__link">
      HailStone
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys114/Momentum/" title="Momentum" class="md-nav__link">
      Momentum
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys114/NIIsolver/" title="NIIsolver" class="md-nav__link">
      NIIsolver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys114/SimplePlots/" title="SimplePlots" class="md-nav__link">
      SimplePlots
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Phys115
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Phys115" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Phys115
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys115/Inductor-Capacitor/" title="Inductor Capacitor" class="md-nav__link">
      Inductor Capacitor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys115/RLC/" title="RLC" class="md-nav__link">
      RLC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys115/Refraction/" title="Refraction" class="md-nav__link">
      Refraction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys115/Resistors/" title="Resistors" class="md-nav__link">
      Resistors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Phys221
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Phys221" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Phys221
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys221/Multiplots/" title="Molecular Speeds lab Python data analysis - multiple gas dataset processing" class="md-nav__link">
      Molecular Speeds lab Python data analysis - multiple gas dataset processing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys221/Single_exp/" title="Molecular Speeds lab Python data analysis - single gas dataset processing" class="md-nav__link">
      Molecular Speeds lab Python data analysis - single gas dataset processing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Phys304
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Phys304" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Phys304
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys304/Ylm/" title="Ylm" class="md-nav__link">
      Ylm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys304/Ylm_interactive/" title="Ylm interactive" class="md-nav__link">
      Ylm interactive
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Phys345
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Phys345" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Phys345
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../01_singlefile_blocks/" title="01 singlefile blocks" class="md-nav__link">
      01 singlefile blocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02_folder_filenames/" title="02 folder filenames" class="md-nav__link">
      02 folder filenames
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03_folder_files_meta/" title="03 folder files meta" class="md-nav__link">
      03 folder files meta
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../04_regex/" title="04 regex" class="md-nav__link">
      04 regex
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MCMC/" title="MCMC" class="md-nav__link">
      MCMC
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Basic fitting
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Basic fitting" class="md-nav__link md-nav__link--active">
      Basic fitting
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nonlinear-fitting-example" class="md-nav__link">
    Nonlinear fitting example
  </a>
  
    <nav class="md-nav" aria-label="Nonlinear fitting example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loading-and-displaying-the-dataset" class="md-nav__link">
    Loading and displaying the dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-the-model-and-testing-it" class="md-nav__link">
    Defining the model and testing it
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-nonlinear-fitting-with-scipyoptimizecurve_fit" class="md-nav__link">
    Simple nonlinear fitting with scipy.optimize.curve_fit
  </a>
  
    <nav class="md-nav" aria-label="Simple nonlinear fitting with scipy.optimize.curve_fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-optimisation-methods-via-lmfitminimize" class="md-nav__link">
    More optimisation methods via lmfit.minimize
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linear_fits/" title="Linear fits" class="md-nav__link">
      Linear fits
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../peak_bayes/" title="Peak bayes" class="md-nav__link">
      Peak bayes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../plotting/" title="Tutorial example: plotting with Python" class="md-nav__link">
      Tutorial example: plotting with Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Phys415
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Phys415" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Phys415
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys415/fresnel/" title="Fresnel" class="md-nav__link">
      Fresnel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys415/multilayer/" title="Multilayer" class="md-nav__link">
      Multilayer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Phys417
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Phys417" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Phys417
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys417/GIS/" title="GIS" class="md-nav__link">
      GIS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../phys417/collapse/" title="Collapse" class="md-nav__link">
      Collapse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Plotting
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Plotting" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Plotting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../plotting/basic/" title="Basic" class="md-nav__link">
      Basic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../plotting/grammar/" title="Grammar" class="md-nav__link">
      Grammar
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nonlinear-fitting-example" class="md-nav__link">
    Nonlinear fitting example
  </a>
  
    <nav class="md-nav" aria-label="Nonlinear fitting example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loading-and-displaying-the-dataset" class="md-nav__link">
    Loading and displaying the dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-the-model-and-testing-it" class="md-nav__link">
    Defining the model and testing it
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-nonlinear-fitting-with-scipyoptimizecurve_fit" class="md-nav__link">
    Simple nonlinear fitting with scipy.optimize.curve_fit
  </a>
  
    <nav class="md-nav" aria-label="Simple nonlinear fitting with scipy.optimize.curve_fit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-optimisation-methods-via-lmfitminimize" class="md-nav__link">
    More optimisation methods via lmfit.minimize
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>Basic fitting</h1>
                
                <h2 id="nonlinear-fitting-example">Nonlinear fitting example</h2>
<p>We'll use an artificial dataset to fit a model with 5 parameters, </p>
<div>
<div class="MathJax_Preview">
y(x) = b_1 \exp\left(-b_2 x\right) + \frac{b_3}{b_5\sqrt{2\pi}} \exp\left(-\tfrac12\frac{(x-b_4)^2}{b_5^2}\right)
</div>
<script type="math/tex; mode=display">
y(x) = b_1 \exp\left(-b_2 x\right) + \frac{b_3}{b_5\sqrt{2\pi}} \exp\left(-\tfrac12\frac{(x-b_4)^2}{b_5^2}\right)
</script>
</div>
<p>It's the sum of a decaying exponential background, and a Gaussian peak.</p>
<p>We first load some standard packages, including <code>scipy.optimize</code> and <code>lmfit</code> for the nonlinear optimisation.</p>
<pre><code class="python">import os, sys
import numpy as np
from numpy import exp, pi, sqrt

from numpy import linspace
from scipy.optimize import leastsq

import pandas as pd
from matplotlib import pyplot

import scipy.optimize as optimization
# conda install -c conda-forge lmfit
from lmfit import minimize, Parameters 
</code></pre>

<h3 id="loading-and-displaying-the-dataset">Loading and displaying the dataset</h3>
<pre><code class="python">data = pd.read_csv(&quot;exppeak.txt&quot;, header=0, delim_whitespace=True)
# note: three ways to refer to a particular column
data.iloc[:,1]
data.loc[:,'x']
data.x
pyplot.errorbar(data.x, data.y, yerr=data.sigma, fmt='.')
</code></pre>

<pre><code>&lt;ErrorbarContainer object of 3 artists&gt;
</code></pre>
<p><img alt="png" src="../../nb_img/phys345/basic_fitting_3_1.png" /></p>
<h3 id="defining-the-model-and-testing-it">Defining the model and testing it</h3>
<p>We now create a function that computes the predicted values for a given set of parameters <span><span class="MathJax_Preview">b_1\dots,b_5</span><script type="math/tex">b_1\dots,b_5</script></span>:</p>
<pre><code class="python">def model_peak(x, b1, b2, b3, b4, b5):
    return b1*exp(-b2*x) + b3/(b5*sqrt(2*np.pi))*exp(-0.5*(x-b4)**2 / b5**2)
</code></pre>

<p>We test it by superposing the prediction and the data (in this artificial example, we know the "true" parameters that were used to generate the dataset).</p>
<pre><code class="python">xx = np.arange(0,10,0.1)
truth = model_peak(xx, 1.12, 1.52, 3, 3.26,  1.48)
pyplot.errorbar(data.loc[:,'x'], data.loc[:,'y'], yerr=data.loc[:,'sigma'], fmt='.', label='data')
pyplot.plot(xx, truth, 'k', label='Truth')
pyplot.legend(loc='best')
</code></pre>

<pre><code>&lt;matplotlib.legend.Legend at 0x7fc1c856a990&gt;
</code></pre>
<p><img alt="png" src="../../nb_img/phys345/basic_fitting_7_1.png" /></p>
<h2 id="simple-nonlinear-fitting-with-scipyoptimizecurve_fit">Simple nonlinear fitting with <code>scipy.optimize.curve_fit</code></h2>
<p>Perhaps the simplest interface for nonlinear fitting is the <code>curve_fit</code> function, which takes as arguments the model defined above, the data, and a set of initial guess parameters. The output of the function is the optimised parameters, and the covariance matrix for the fitted parameters:</p>
<pre><code class="python">import scipy.optimize as optimization
p0 = [1, 1, 1, 4,  1]
popt, pcov = optimization.curve_fit(model_peak, data.x, data.y, p0, data.sigma)
popt
</code></pre>

<pre><code>array([1.08251862, 1.59378021, 3.11029724, 3.20655998, 1.55177204])
</code></pre>
<pre><code class="python">pcov
</code></pre>

<pre><code>array([[ 0.00100275, -0.00034778, -0.00109506,  0.00055618, -0.00067476],
       [-0.00034778,  0.01995825,  0.01065553, -0.00575757,  0.00480145],
       [-0.00109506,  0.01065553,  0.00957323, -0.00355233,  0.00408678],
       [ 0.00055618, -0.00575757, -0.00355233,  0.00289486, -0.00165942],
       [-0.00067476,  0.00480145,  0.00408678, -0.00165942,  0.00249512]])
</code></pre>
<p>We can visualise the output to confirm that the fit is reasonable.</p>
<pre><code class="python">guess = model_peak(xx, *p0)
fit = model_peak(xx, *popt)
pyplot.errorbar(data.loc[:,'x'], data.loc[:,'y'], yerr=data.loc[:,'sigma'], fmt='.', label='data')
pyplot.plot(xx, truth, 'k-', label='Truth')
pyplot.plot(xx, guess, 'g', label='Guess')
pyplot.plot(xx, fit, 'r', label='curve_fit')
pyplot.legend(loc='best')
pyplot.xlabel(&quot;x&quot;)
pyplot.ylabel(&quot;y&quot;)
</code></pre>

<pre><code>Text(0, 0.5, 'y')
</code></pre>
<p><img alt="png" src="../../nb_img/phys345/basic_fitting_12_1.png" /></p>
<h3 id="more-optimisation-methods-via-lmfitminimize">More optimisation methods via <code>lmfit.minimize</code></h3>
<p><code>curve_fit</code> is simple to use, but not very flexible. We'll try another alternative here, which requires a little more effort in the setup, but provides more options such as different algorithms for the search.</p>
<pre><code class="python">from lmfit import minimize, Parameters, Model, report_fit
from scipy.optimize import leastsq

</code></pre>

<p>Here we need to provide <code>minimize</code> with the normalised residuals (note: they are not squared, as minimize will square them internally for least-square based methods):</p>
<pre><code class="python">def residuals(pars, x, y, eps):
    A1 = pars['A1'].value
    Decay = pars['Decay'].value
    A2 = pars['A2'].value
    Position = pars['Position'].value
    Width = pars['Width'].value

    model = A1*exp(-Decay*x) + A2/(Width*sqrt(2*np.pi))*exp(-0.5*(x-Position)**2 / Width**2)

    return (y-model) / eps

</code></pre>

<p>The rest of the setup consists in creating a <code>Parameters</code> object holding the information for all free parameters (at a minimum, their name and initial guess for the value, but one can also set constraints). We can then call the minimize function:</p>
<pre><code class="python">params = Parameters()
params.add('A1', value=1.0)
params.add('Decay', value=1.5)
params.add('A2', value=0.5)
params.add('Position', value=3.0)
params.add('Width', value=1.5)

out = minimize(residuals, params, args=(data.x, data.y, data.sigma), method='leastsq')

print(&quot;# Fit using leastsq:&quot;)
report_fit(out)
</code></pre>

<pre><code># Fit using leastsq:
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 43
    # data points      = 20
    # variables        = 5
    chi-square         = 10.0399205
    reduced chi-square = 0.66932803
    Akaike info crit   = -3.78326151
    Bayesian info crit = 1.19539985
[[Variables]]
    A1:        1.08251850 +/- 0.03166571 (2.93%) (init = 1)
    Decay:     1.59378187 +/- 0.14126643 (8.86%) (init = 1.5)
    A2:        3.11029830 +/- 0.09784307 (3.15%) (init = 0.5)
    Position:  3.20655937 +/- 0.05380360 (1.68%) (init = 3)
    Width:     1.55177259 +/- 0.04995053 (3.22%) (init = 1.5)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(A2, Width)       = 0.836
    C(Decay, A2)       = 0.771
    C(Decay, Position) = -0.757
    C(Decay, Width)    = 0.680
    C(A2, Position)    = -0.675
    C(Position, Width) = -0.617
    C(A1, Width)       = -0.427
    C(A1, A2)          = -0.353
    C(A1, Position)    = 0.326
</code></pre>
<p>We can compare the fitted parameters to those obtained via curve_fit:</p>
<pre><code class="python">
with np.printoptions(precision=3, suppress=True):
    print(&quot;# Fit using curve_fit:&quot;)
    print(popt)
</code></pre>

<pre><code># Fit using curve_fit:
[1.083 1.594 3.11  3.207 1.552]
</code></pre>
<p>and their uncertainty, which are estimated by the diagonal components of the covariance matrix:</p>
<pre><code class="python">
with np.printoptions(precision=3, suppress=True):
    print(&quot;# Uncertainties using curve_fit:&quot;)
    print(np.sqrt(np.diag(pcov)))

</code></pre>

<pre><code># Uncertainties using curve_fit:
[0.032 0.141 0.098 0.054 0.05 ]
</code></pre>
<p>We could also obtain such undertainty estimates "manually", by evaluating the Hessian matrix at the optimum position in the parameter space:</p>
<pre><code class="python"># conda install -c conda-forge numdifftools 
import numdifftools as nd

# vals = out.params.valuesdict()
opt = np.array(out.params)

# residuals(pars, x, y, eps)
def objective(p):
    model = model_peak(data.x, *p)
    chi2 = np.sum(((data.y-model) / data.sigma)**2)
    return chi2

H = nd.Hessian(objective)(popt)

with np.printoptions(precision=3, suppress=True):
    print(H)
</code></pre>

<pre><code>[[2146.055 -379.742  191.581 -583.046  609.5  ]
 [-379.742  290.208 -176.365  354.949 -134.703]
 [ 191.581 -176.365  645.87    36.894 -642.168]
 [-583.046  354.949   36.894 1307.605  -38.95 ]
 [ 609.5   -134.703 -642.168  -38.95  1983.361]]
</code></pre>
<p>The covariance matrix is obtained as the inverse of half the Hessian matrix. The uncertainty of each parameter are the square root of the diagonal elements of this covariance matrix.</p>
<pre><code class="python">cov = np.linalg.inv(0.5*H)
with np.printoptions(precision=3, suppress=True):
    print(cov)
    print(&quot;# Uncertainties from the covariance matrix:&quot;)
    print(np.sqrt(np.diag(cov)))
</code></pre>

<pre><code>[[ 0.001 -0.    -0.002  0.001 -0.001]
 [-0.     0.029  0.016 -0.008  0.007]
 [-0.002  0.016  0.014 -0.005  0.006]
 [ 0.001 -0.008 -0.005  0.004 -0.002]
 [-0.001  0.007  0.006 -0.002  0.004]]
# Uncertainties from the covariance matrix:
[0.039 0.171 0.119 0.065 0.061]
</code></pre>
<p>Changing the method produces similar results:</p>
<pre><code class="python">out2 = minimize(residuals, params, args=(data.x, data.y, data.sigma), method='lbfgsb')
print(&quot;# Fit using lbfgsb:&quot;)
report_fit(out2)
</code></pre>

<pre><code># Fit using lbfgsb:
[[Fit Statistics]]
    # fitting method   = L-BFGS-B
    # function evals   = 120
    # data points      = 20
    # variables        = 5
    chi-square         = 10.0399205
    reduced chi-square = 0.66932803
    Akaike info crit   = -3.78326151
    Bayesian info crit = 1.19539985
[[Variables]]
    A1:        1.08251844 +/- 0.03164248 (2.92%) (init = 1)
    Decay:     1.59378189 +/- 0.13987566 (8.78%) (init = 1.5)
    A2:        3.11029856 +/- 0.09720750 (3.13%) (init = 0.5)
    Position:  3.20655917 +/- 0.05329030 (1.66%) (init = 3)
    Width:     1.55177273 +/- 0.04973770 (3.21%) (init = 1.5)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(A2, Width)       = 0.834
    C(Decay, A2)       = 0.767
    C(Decay, Position) = -0.753
    C(Decay, Width)    = 0.675
    C(A2, Position)    = -0.668
    C(Position, Width) = -0.609
    C(A1, Width)       = -0.426
    C(A1, A2)          = -0.352
    C(A1, Position)    = 0.324
</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../MCMC/" title="MCMC" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                MCMC
              </div>
            </div>
          </a>
        
        
          <a href="../linear_fits/" title="Linear fits" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Linear fits
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>